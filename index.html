<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Control Panel</title>
    <script src="https://unpkg.com/jsplumb/dist/js/jsplumb.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="style2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

</head>
<body>
  

    <main class="panel"> 
        <section class="top-row">
            <aside class="left-column">
                <div class="mcb-starter-section"> 
                    <div class="mcb-block">
                        <img id="mcbToggle"  class="mcb-toggle" src="images/mcb-off.png"  alt="MCB"/>

                        <h3 class="mcb-label">DC SUPPLY</h3>
                         <div>
              
                         <button class="point-A">A</button>
                <div id="pointA" class="point"></div>
              
             <button class="point-B">B</button>
             
             <div id="pointB" class="point"></div>
            </div>
                    </div>
                 


                    <div class="starter-block">
                         <h3 class="starter-label">
                            Starter
                        </h3>
                        <img class="starter-body" src="images/starter.png" alt="Starter body">
                        
                        <img class="starter-handle" src="images/starter-handle.png" alt="Starter handle">
                        <div>
              <button class="point-P">P</button>
             <button class="point-Q">Q</button>
             <button class="point-R">R</button>
             <div id="pointP" class="point"></div>
             <div id="pointQ" class="point"></div>
             <div id="pointR" class="point"></div>
            </div>
 
                    </div>
                </div>
                 <div class="rheostat">  
                        <h3 class="rheostat-label1">Field rheostat</h3>
                    
                        <img class="rheostat-img-1" id="rheostat-1" src="images/Rheostat.png" alt="Rheostat">
                        <img class="nob1" src="images/nob.png" alt="nob1">
                       
                         <div>
                  <button class="point-E">E</button>
                  <button class="point-F">F</button>
                        
                  <div id="pointE" class="point"></div>
                  <div id="pointF" class="point"></div>

                </div>
                </div>            
              
                <div class="rheostat"> 
                  
                        <h3 class="rheostat-label2">Armature rheostat</h3>
                        
                        <img class="rheostat-img-2" id="rheostat-2" src="images/Rheostat.png" alt="Rheostat">
                          <img id="nob2" class="nob2" src="images/nob.png" alt="nob2">
                           
                 <div>
                  <button class="point-G">G</button>
                  <button class="point-H">H</button>
                        
                  <div id="pointG" class="point"></div>
                  <div id="pointH" class="point"></div>
                   
                </div>
    
                </div>       
            </aside>

            <section class="center-column">

                    
 
                <div class="meter-panel">                  
                    <div class="meters">
                        <h3 id="ammter1-label">VOLTMETER</h3>                       
                        <h3 id="voltmeter1-label">AMMETER</h3>
                         <h3 id="rpm1-label">Digital RPM Indicator</h3>
                        <div class="meter-card">

                          <img src="images/voltmeter.png"   class="voltmeter-img" alt="Voltmeter">
                           
                          
                          
                          <div class="meter-needle3">
                                <div class="meter-needle3">
                                <img src="images/needle.png" alt="needle"> 
                                </div>
                            </div>
                        </div>
                                            <div>
                    <button class="point-I">I</button>
                   <button class="point-J">J</button>
                    
                   <div id="pointI" class="point"></div>
                   <div id="pointJ" class="point"></div>
                  </div>
                  
                          <div class="meter-card  ammeter-card">
                             <div class="ammeter-inner">
                             <img src="images/ammeter.png"  class="ammeter-img" alt="Ammeter">
                             <div class="meter-needle1 ammeter-needle">
                             <img src="images/needle.png" alt="needle">
                             </div>
                        <div class="ammeter-points">
                    <button class="point-L">L</button>
                   <button class="point-M">M</button>
                    
                   <div id="pointL" class="point"></div>
                   <div id="pointM" class="point"></div>
                         </div>
                        </div>
                    </div>
                        <div class="meter-card rpm-card">
                                      <img src="images/rpm.png" id="rpm-indicator" alt="RPM Indicator" class="rpm-image">
                                        <div id="rpmDisplay" class="rpm-display">0</div>
                                    </div>
                    
                    </div>
                </div>
               

                <div class="workspace">
                    
                    <div class="equipment-row">
                        <div class="assembly">
                              
                            <div class="motor-box">
                               <h3 class="labeld">DC SHUNT Motor</h3>
                             <img src="images/shuntmotor.png" alt="Motor">
                             <div>
                  <button class="point-K">K</button>
                  <button class="point-Y">Y</button>
                  <div id="pointK" class="point"></div>
                  <div id="pointY" class="point"></div>
                   
                </div>
                            </div>
                         <div>
                     <button class="point-C">C</button>
                     <button class="point-D">D</button>
                           
                     <div id="pointC" class="point"></div>
                     <div id="pointD" class="point"></div>
                   
                </div>
                
                 
        
                            <div class="generator-box">
                                <h3 class="labeld">ROTOR view</h3>
                                <img class="generator-body" src="images/Rotor-body.png" alt="Rotor body">
                                <img class="generator-rotor" id="gr" src="images/Generator-Rotor.png" alt="Generator rotor">
                                
                            </div>
                            
                         </div>
                    
                    </div>
                    </div>
                   
                    <div class="center-actions">
                               
                               
                                </div>
              
                
            </section>

            <aside class="right-column">

    <div class="pill-stack">
        <div class="action-controls">
        <div class="instructions-wrapper">
       <button class="pill-btn instructions-btn">
      <i class="fa-solid fa-circle-info"style="font-size:16px;"></i>&nbsp;&nbsp;
  <span>Instructions</span>
</button>

        <div class="instructions-panel">
              <h4>STEP 1: Make connections as per instructions below:</h4>
               <table class="conn-table">
                    <tr>
                       <th>From</th>
                        <td>A</td><td>B</td><td>B</td><td>B</td><td>Q</td><td>G</td><td>E</td><td>F</td><td>H</td><td>I</td><td>C</td>
                     </tr>
                     <tr>
                         <th>To</th>
                         <td>P</td><td>K</td><td>Y</td><td>J</td><td>L</td><td>R</td><td>M</td><td>D</td><td>I</td><td>C</td><td>H</td>
                     </tr>
               </table><br>

              <p><strong>STEP 2:</strong>Then Check the connections by clicking on <b>"Check"</b> Button..</p><br>
              <p><strong>STEP 3:</strong>If it shows alert <b>"Incorrect Corrections"</b> then click on node number to detach the wire or press reset button and make connection again.</p><br>   
              <p><strong>STEP 4:</strong>  If it shows alert <b>"Correct Connections"</b> then Turn On the MCB.</p><br>
              <p><strong>STEP 5:</strong> Then set the Voltmeter first with the help of the second slider.</p><br>
              <p><strong>STEP 6:</strong>  Now, move the first slider to get corresponding values of Ammeter and Speedometer.</p><br>
              <p><strong>STEP 7:</strong> Click on <b>"Graph"</b>Press the <b>"Add to table"</b> button to insert the values in the table.</p><br>
              <p><strong>STEP 8:</strong> Click on <b>"Print"</b> After inserting values on table click on <b>"Plot graph"</b> to get your required graph.</p><br>
              <p><strong>STEP 9:</strong> Click on <b>"Print"</b> button to print the webpage.</p><br>
              <p><strong>STEP 10:</strong> Click on <b>"Reset"</b> button to reset the webpage.</p><br>
  </div>
</div>

        
        <button class="pill-btn">
        <i class="fa-solid fa-check" style="font-size:16px;"></i>&nbsp;&nbsp;
        <span>Check</span>
         </button>
         
<button class="pill-btn speak-btn" type="button" aria-pressed="false" aria-label="Start Speaking / Tap To Listen" title="Start Speaking / Tap To Listen">
            <span class="speak-btn__icon" aria-hidden="true">
              <svg class="speak-btn__svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" focusable="false" aria-hidden="true">
                <path d="M11 5L6 9H3v6h3l5 4V5z" />
                <path class="speak-btn__wave wave-1" d="M15.5 8.5a4 4 0 010 7" />
                <path class="speak-btn__wave wave-2" d="M17.8 6.2a7 7 0 010 11.6" />
                <path class="speak-btn__wave wave-3" d="M20.1 3.9a10 10 0 010 16.2" />
              </svg>
            </span>&nbsp;&nbsp;
            <span class="speak-btn__label">Tap To Listen</span>
          </button>
          
          
          <button class="pill-btn" id="auto">
            <i class="fa-solid fa-link" style="font-size:16px;"></i>&nbsp;&nbsp;
            <span >Auto Connect </span>
        </button>






        <button class="pill-btn obs-add-btn" id="addTableBtn" type="button">
            <i class="fa-solid fa-table" style="font: size 14px;"></i>&nbsp;
            <span>Add To Table</span>
        </button>


          <button class="pill-btn" id="resetBtn">
                <i class="fa-solid fa-arrow-rotate-right"  style="font-size:16px;"></i>&nbsp;&nbsp;
                <span>Reset</span>
            </button>
            
         </div>

         <div class="observation-panel">
                         <section class="observation-section">
                        <div class="observation-header">
                            <div>
                                <h3>OBSERVATION TABLE</h3>
                            
                            </div>
                        </div>
                        
                        <div class="observation-table-wrapper">
                            <table id="observationTable">
                                <thead>
                                    <tr>
                                        <th>S. No.</th>
                                        <th> Field Current (A)</th>
                                        <th>Speed (RPM)</th>
                                    </tr>
                                </thead>
                                <tbody id="observationBody">
                                    <tr class="placeholder-row">
                                       
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                        </div>
    </div>
        
</aside>

        </section>


      <section class="graph-section">
            
            <div class="graph-header">
                <h3>Output Graph</h3>
                <div class="graph-actions">
                    

            
            <button class="pill-btn" id="plotGraphBtn">
                <i class="fa-solid fa-chart-area"  style="font-size:16px;"></i>&nbsp;&nbsp;
                <span>Graph</span>
            </button>
            
           <button class="pill-btn" id="reportBtn">
  <i class="fa-solid fa-file"></i>&nbsp;&nbsp;
  <span>Report</span>
</button>


           
            <button class="pill-btn">
                <i class="fa-solid fa-print" style="font-size:16px;"></i>&nbsp;&nbsp;
                <span>Print</span>
            </button>
            </div>
                <span class="graph-caption"></span>
            
            </div>
     <div class="graph-canvas">
  <div id="graphBars" class="graph-bars"></div>
  <div id="graphPlot" class="graph-plot"></div>
</div>
        </section>    

    </main>
     

    <script src="script.js"></script>



<!-- COMPONENTS MODAL -->
<div id="componentsModal" class="components-overlay hidden">
  <div class="components-dialog">

    <div class="components-header">
      <span class="components-title">Components</span>

      <div class="components-actions">
   <button
    id="componentsAudioBtn"
    class="comp-btn"
    aria-pressed="false"
  >
    Play Audio
  </button>

<button
  id="skipComponentsBtn"
  class="comp-btn"
  data-components-skip
>
  Skip
</button>

<button
  id="closeComponentsBtn"
  class="comp-close"
  data-components-close
>
  ✕
</button>

      </div>
    </div>

    <iframe
      id="componentsFrame"
      src="./components.window.html"
      allow="autoplay"
    ></iframe>

  </div>
</div>
<script>
let audioEnabled = false;
let currentUtterance = null;

function unlockAudio() {
  try {
    speechSynthesis.cancel();
    speechSynthesis.speak(new SpeechSynthesisUtterance(" "));
    audioEnabled = true;
  } catch (e) {}
}

function playComponentAudio() {
  if (!audioEnabled) unlockAudio();

  speechSynthesis.cancel();
  currentUtterance = new SpeechSynthesisUtterance(
    "This window shows the components used in the experiment."
  );
  currentUtterance.rate = 0.9;
  speechSynthesis.speak(currentUtterance);
}

function stopComponentAudio() {
  speechSynthesis.cancel();
}

window.addEventListener("message", (event) => {
  const data = event.data || {};

  if (data.type === "component-audio-play") {
    playComponentAudio();
    event.source.postMessage(
      { type: "component-audio-state", state: { playing: true } },
      "*"
    );
  }

  if (data.type === "component-audio-stop") {
    stopComponentAudio();
    event.source.postMessage(
      { type: "component-audio-state", state: { playing: false } },
      "*"
    );
  }

  if (data.type === "component-audio-toggle") {
    if (speechSynthesis.speaking) {
      stopComponentAudio();
      event.source.postMessage(
        { type: "component-audio-state", state: { playing: false } },
        "*"
      );
    } else {
      playComponentAudio();
      event.source.postMessage(
        { type: "component-audio-state", state: { playing: true } },
        "*"
      );
    }
  }
});
</script>


<!-- FLOATING CHATBOT + COMPONENTS -->
<div class="chatbot-widget">

  <!-- CHATBOT WITH LABEL -->
  <div class="chatbot-with-text">

    <span class="chatbot-text">
      Ask anything about this experiment
    </span>
  <!-- CHATBOT BUTTON -->
  <button
    type="button"
    class="chatbot-launcher"
    id="chatbotLauncher"
    aria-label="Open chatbot"
    title="Chatbot"
  >
    <img
      src="images/chatbot.png"
      alt="Chatbot"
      class="chatbot-launcher__icon"
    />
  </button>

  <!-- COMPONENTS BUTTON (your existing one) -->
  <button
    type="button"
    class="components-launcher"
    id="componentsLauncher"
    aria-label="Open components"
    title="Components"
  >
    <img
      src="images/comicon.png"
      alt="Components"
      class="components-launcher__icon"
    />
  </button>

</div>

<script>
  const componentsLauncher = document.getElementById("componentsLauncher");
  const componentsModal = document.getElementById("componentsModal");

  const closeButtons = componentsModal.querySelectorAll(
    "[data-components-close], [data-components-skip]"
  );

  // OPEN MODAL
  componentsLauncher.addEventListener("click", () => {
    componentsModal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  });

  // CLOSE MODAL
  closeButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      componentsModal.classList.add("hidden");
      document.body.style.overflow = "";
      if (window.speechSynthesis) speechSynthesis.cancel();
    });
  })

  // ESC KEY CLOSE
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !componentsModal.classList.contains("hidden")) {
      componentsModal.classList.add("hidden");
      document.body.style.overflow = "";
      if (window.speechSynthesis) speechSynthesis.cancel();
    }
  });
</script>
<script>
const audioBtn = document.getElementById("componentsAudioBtn");

audioBtn.addEventListener("click", () => {
  const isPlaying = audioBtn.getAttribute("aria-pressed") === "true";

  if (isPlaying) {
    // STOP AUDIO
    stopComponentAudio();
    audioBtn.textContent = "Play Audio";
    audioBtn.setAttribute("aria-pressed", "false");

    // sync iframe button state
    const iframe = document.getElementById("componentsFrame");
    iframe?.contentWindow?.postMessage(
      { type: "component-audio-stop" },
      "*"
    );

  } else {
    // PLAY AUDIO
    playComponentAudio();
    audioBtn.textContent = "Stop Audio";
    audioBtn.setAttribute("aria-pressed", "true");

    // sync iframe button state
    const iframe = document.getElementById("componentsFrame");
    iframe?.contentWindow?.postMessage(
      { type: "component-audio-play" },
      "*"
    );
  }
});
</script>


<!-- =========================
     CHATBOT PANEL
========================= -->
<div class="chatbot-panel" id="chatbotPanel" data-chat-url="https://vlab-exp-2.netlify.app/">

  <div class="chatbot-panel-header">
    <div>
      <p class="chatbot-panel-title">Virtual Lab Assistant</p>
      <p class="chatbot-panel-caption">Ask anything about this experiment</p>
    </div>

    <button
      type="button"
      class="chatbot-panel-close"
      id="chatbotCloseBtn"
      aria-label="Close chatbot"
    >
      ✕
    </button>
  </div>

  <div class="chatbot-panel-body">
    <div class="chatbot-panel-placeholder">
      Loading assistant...
    </div>
    <iframe
      id="chatbotIframe"
      title="Chatbot assistant"
      referrerpolicy="no-referrer"
      scrolling="no"
    ></iframe>
  </div>
</div>

<!-- Chatbot notification sound (optional) -->
<audio id="chatbot-notification-audio" preload="auto">
  <source src="audio/live-chat-353605.mp3" type="audio/mpeg">
</audio>
<script>
(function initChatbot() {
  const launcher = document.getElementById("chatbotLauncher");
  const panel = document.getElementById("chatbotPanel");
  const closeBtn = document.getElementById("chatbotCloseBtn");
  const iframe = document.getElementById("chatbotIframe");
  const placeholder = panel.querySelector(".chatbot-panel-placeholder");
  const chatUrl = panel.dataset.chatUrl;
  const notifyAudio = document.getElementById("chatbot-notification-audio");

  if (!launcher || !panel || !closeBtn || !iframe) return;

  let loaded = false;
  let notified = false;

  function openChatbot() {
    panel.classList.add("open");

    if (!loaded && chatUrl) {
      placeholder.style.display = "flex";
      iframe.src = chatUrl;

      iframe.addEventListener("load", () => {
        iframe.classList.add("visible");
        placeholder.style.display = "none";
        loaded = true;
      }, { once: true });
    }

    if (!notified && notifyAudio) {
      notified = true;
      try {
        notifyAudio.currentTime = 0;
        notifyAudio.play().catch(()=>{});
      } catch {}
    }
  }

  function closeChatbot() {
    panel.classList.remove("open");
  }

  launcher.addEventListener("click", openChatbot);
  closeBtn.addEventListener("click", closeChatbot);

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && panel.classList.contains("open")) {
      closeChatbot();
    }
  });
})();
</script>
<!-- COMPONENT INFO POPUP -->
<div id="componentInfoPopup" class="component-popup hidden">
  <div class="popup-arrow"></div>
  <div class="popup-content">
    <div class="popup-accent"></div>
    <div class="popup-text" id="popupText"></div>
  </div>
</div>

<!-- Custom Alert Modal -->
<div id="warningModal" class="modal">
  <div id="modalBox" class="modal-box">
    <h2 id="modalTitle">Alert</h2>
    <p id="modalMessage"></p>
    <button id="modalOkBtn" class="modal-close-btn">OK</button>
  </div>
</div>



</body>
</html>